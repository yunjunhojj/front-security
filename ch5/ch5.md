# XSS - cross site scripting

수동적 기법의 대표 기법

## 능동적 기법 vs 수동적 기법

- 능동적 기법 : SQL인젝션, OS 명력인젝션 처럼 직접 공격 코드를 보내는 방식
- 수동적 기법 : 공격자가 미리 준비한 피싱 사이트를 이용해 웹 어플리케이션에 방문한 사용자가 공격 코드를 실행하도록 하는 공격

## 수동적 기법의 대표적 예시

- XSS : (cross site scripting) 악성 스크립트를 실행하는 공격 / 공격자의 페이지에서 진행되므로 동일출처정책에 위반하지 않음
- CSRF : (cross site request forgery)
- 클릭지킹 : (click jacking)
- 오픈 리다이렉트 : (open redirect)

## XSS 구조

XSS는 사용자가 입력한 문자열을 그대로 HTML에 삽입할 때 방생하는 취약점이다.

https://site.example/search?keyword=보안 -> 이라는 url 을 갖고 이를 화면에 보여줄 때

```html
<!-- keyword의 값 '보안'이 삽입됨 -->
<div id="keyword">검색 키워드 : 보안</div>
```

위 처럼 그대로 삽입하면 문제가 발생한다 예를 들면 url을 아래와 같이 바꿀 경우, 강제로 웹사이트를 이동시킬 수 있다.
(이 밖에 다양한 데이터를 다른 곳으로 이동시킬 수 있다.)

https://site.example/search?keyword=(img src onerror="location.href="https://attacker.example"/)

```html
<div id="keyword">
  검색 키워드 : (img src onerror="location.href="https://attacker.example"/)
</div>
```

## XSS 종류

- 반사형 : 공격자가 준비한 함정에서 발생하는 요청에 잘못된 스크립트를 포함하는 HTML을 서버에서 생성해 발생하는 XSS (비지속형)
- 저장형 : 공격자가 폼 등으로 부터 제출한 악성 스크립트를 포함하는 데이터가 서버에 저장되고 저장된 데이터 내 악성 스크립트가 웹 애플리케이션 페이지에 반영되어 발생하는 XSS이다 (지속형)
- DOM 기반 : 자바스크립트로 DOM을 조작할 때 발생하는 XSS 이다.

## XSS 대책

XSS (Cross-Site Scripting)는 웹 애플리케이션에서 발생하는 보안 취약점 중 하나입니다. 공격자는 악의적인 스크립트를 삽입하여 사용자의 브라우저에서 실행되도록 만들고, 이를 통해 사용자의 정보를 탈취하거나 악의적인 행동을 수행할 수 있습니다.

XSS 공격은 주로 세 가지 유형으로 나뉩니다:

반사형 XSS (Reflected XSS): 공격자가 준비한 함정에서 발생하는 요청에 잘못된 스크립트를 포함하는 HTML을 서버에서 생성해 발생하는 XSS입니다. 이는 비지속적인 공격으로, 사용자가 악성 링크를 클릭하거나 특정한 요청을 보낼 때 발생할 수 있습니다.

저장형 XSS (Stored XSS): 공격자가 폼 등을 통해 제출한 악성 스크립트를 포함하는 데이터가 서버에 저장되고, 저장된 데이터 내의 악성 스크립트가 웹 애플리케이션 페이지에 반영되어 발생하는 XSS입니다. 이는 지속적인 공격으로, 사용자가 해당 페이지를 방문할 때마다 악성 스크립트가 실행될 수 있습니다.

DOM 기반 XSS (DOM-based XSS): 자바스크립트로 DOM을 조작할 때 발생하는 XSS입니다. 이는 웹 애플리케이션의 클라이언트 측 스크립트에서 발생하며, 주로 웹 페이지의 URL 파라미터나 해시값을 조작하여 악성 스크립트를 실행시킵니다.

XSS 공격을 방지하기 위해 몇 가지 대책을 적용할 수 있습니다:

입력 데이터의 필터링 및 이스케이프: 사용자로부터 입력받은 데이터를 신뢰할 수 있는 형태로 변환하거나, 특수 문자를 이스케이프하여 스크립트 실행을 방지합니다.

콘텐츠 보안 정책 (Content Security Policy, CSP): 웹 애플리케이션에서 로드되는 리소스의 출처를 제한하여 악성 스크립트의 실행을 방지합니다.

웹 애플리케이션의 취약점 분석 및 보완: 보안 취약점 스캐너를 사용하여 XSS 취약점을 탐지하고, 적절한 보완 조치를 취합니다.

안전한 쿠키 설정: 쿠키에 중요한 정보를 저장하지 않거나, 쿠키의 속성을 설정하여 XSS 공격에 대비합니다.

이러한 대책을 적용하여 웹 애플리케이션에서 XSS 공격을 예방할 수 있습니다.

# Content Security Policy를 사용한 XSS 대체하기

## CSP 란 무엇?

CSP는 서버에서 허용되지 않은 자바스크립트의 실행과 리소스 불러오기 등을 차단하며, 대부분의 브라우저에서 CSP를 지원한다.

# 토큰을 사용하는 CSRF 대책

CSRF의 가장 효과적인 대책은 토큰을 사용하는 방법

토큰이란 간단하게 비밀 문자열이라고 생각하면된다.

토큰 생성: 사용자가 로그인하거나 양식 페이지를 로드하면 서버는 고유한 CSRF 토큰을 생성하고 이를 사용자 세션과 연결합니다. 그런 다음 이 토큰은 양식에 포함되거나 페이지의 메타데이터에 포함됩니다.

토큰 포함: CSRF 토큰은 일반적으로 HTML 양식에 숨겨진 필드로 포함되거나 요청 헤더에 추가됩니다. 사용자가 양식을 제출하거나 사이트와 상호 작용하면 요청과 함께 토큰이 전송됩니다.

토큰 확인: 요청을 받으면 서버는 요청의 CSRF 토큰이 사용자 세션과 연결된 토큰과 일치하는지 확인합니다. 토큰이 일치하면 요청이 처리됩니다. 그렇지 않으면 잠재적으로 악의적인 것으로 간주되어 거부됩니다.

보호 메커니즘: CSRF 토큰은 공격자가 요청을 위조하는 것을 어렵게 만들어 보호 기능을 제공합니다. 각 토큰은 고유하고 특정 사용자 세션에 연결되어 있으므로 공격자는 악의적인 요청에 포함할 올바른 토큰 값을 예측하거나 추측할 수 없습니다.

토큰 만료: CSRF 토큰은 수명이 제한되거나 특정 작업과 연결되는 경우가 많습니다. 이렇게 하면 공격자가 이전 세션이나 가로채는 요청에서 얻은 토큰을 재사용하는 것을 방지할 수 있습니다.
